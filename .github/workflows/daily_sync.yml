steps:
  - name: Checkout code
    uses: actions/checkout@v3

  - name: Set up Python
    uses: actions/setup-python@v4
    with:
      python-version: '3.9'

  - name: Install dependencies
    run: pip install tweepy

  - name: Run sync script
    env:
      TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}
    run: python sync_tweets.py

  - name: Commit and push changes
    run: |
      git config --global user.name "github-actions[bot]"
      git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      # Check if the file exists before trying to add it
      if [ -f my_tweets.md ]; then
        git add my_tweets.md
        # Only commit if there are actually changes to prevent "nothing to commit" errors
        git diff-index --quiet HEAD || git commit -m "Automated update: $(date)"
        git push
      else
        echo "File my_tweets.md does not exist. Skipping commit."
      fi
